# Jisho Matcher 语法使用指北

Jisho Matcher 采用类 QAT 的语法设计进行日语词汇匹配。

## 0. 背景介绍

Jisho Matcher 采用豚辞書，收录约二十万条日语词汇。

注意：

1. 该辞書的所有词语均用平假名和长音符号呈现，所有片假名词语都已经过平假名化处理，设计匹配时无需考虑片假名。
2. 该辞書的所有促音っ，拗音ゃゅょ，捨て仮名ぁぃぅぇぉ等都被正体化大写，与正常假名无异，设计匹配时无需考虑。

**兼容性说明**

为便利日语键盘的输入，Jisho Matcher 对特殊符号的使用有很高的包容度 (即支持全角符号)。

如`?`可以与`？`等价交换使用，`「」`与`[]`可以交换使用等等。

## 1. 核心语法

### 1.1 通配符

`?`: 单个假名（包括长音符号ー）

`*`: 多个假名（包括0个）

注：?不可使用带长度的`{}`判定

### 1.2 属性匹配

**长度属性**

`*{m-n}`:  m-n个假名，`m-`表示长度$\geq m$，`-n`表示长度$\leq n$, `m`表示长度$=m$

**类别属性**

我们使用小写字母以匹配段，行与拨音ん：

`?[kgt]`: 匹配在か行，が行或た行上的假名

`*{1-3}[aep]`: 匹配一到三个在あ段，え段或ぱ行上的假名

`?[nn]`: 匹配ん

特殊地：あ行用`aa`表示，ん用`nn`表示

## 1.3 逻辑运算

对于类别属性，您也可以使用`&`，`|`，与`!`来细化类别：

`?[aa|s&a]`: 匹配あ行或さ

`*{2}[!あのみ]`: 匹配两个不是あのみ三个之一的假名

非运算`！` 的优先级最高，其次是 与运算`&` 和 或运算`|`

对于多个条件的嵌套，请使用`()`划定范围：

`?[(!ai)&stn]`:匹配不在あ段，い段，且在さ行，た行和な行的字符。

## 1.4 进阶功能

Jisho Matcher 提供**重排**操作，用`<>`包裹：

`<ありう??>`: 匹配所有包含ありう的五字符词语
`く<?ね>`: 匹配所有以く开头，且三四字符包含ね的四字符词语

注：重排内无法使用属性匹配`{}[]`

Jisho Matcher 提供**成词**匹配，用`＠`表示：

`そと@`: 匹配所有以そと开头，尾部可独立成词的所有词语
`*{1-3}[st&!i]@`:匹配所有由1-3个不在い段的さ行，た行假名开头，尾部可独立成词的所有词语

## 1.5 全局逻辑运算

除了通配符可使用逻辑运算以外，多个匹配串之间也可以使用逻辑运算（即`&`，`|`，与`!`）。

`??[!そ]そ??|?そ?[!そ]??`: 匹配所有第二个/第三个字符中有且仅有一个是そ的五字符词语

# 2. 代数式匹配 (类QAT)
*本模块可部分参考 QAT 的语法*

*使用 QAT 可能会显著增加搜索时间，请谨慎使用！*

QAT 表达式由多个子表达式组成，用`;`分割

未知的子串（变量）由大写字母(`A-Z`)表示，默认长度$\geq 1$

QAT 子表达式有两种类型：**匹配串**和**约束条件**

**匹配串**

由核心语法中的元素与 QAT 变量组成，并成词

`AB?ま;A;B`：匹配所有最后一个字符为ま，且去除末尾两个字符后可以拆成两个部分独立成词的词语


**约束条件**

由等于号和变量组成的约束条件。

`ABA;|A|=1;|B|=2`：匹配所有符合`ABA`结构的词语，其中`A`是单字符，`B`是两字符
	
该表达式等价匹配：匹配所有四字符长，且首尾字符相同的短语

注：现约束条件只有长度约束

## 2.1 长度

规定变量的长度。格式为`|X|=n`

`ABそ;B;|A|=1`：匹配所有符合`ABそ`的词语，其中`A`是单字符，`B`可单独成词。
	
该表达式等价匹配：`?@そ`


## 2.2 浊化与半浊化

在变量后添加 `"` 或 `'` 可以浊化/半浊化该变量

`A"BA'B;|A|=1;|B|=1`: 匹配一个四字符单词。其中第二个字符和第四个字符相同，且第一个字符和第三个字符是一个假名所对应的浊音和半浊音。

注：被（半）浊化的变量一定不包含浊音或半浊音

`AB";A"B";|B|=1`: 匹配两个结尾为浊音的单词，且第一个单词除去结尾都不是浊音，第二个单词除去结尾是第一个单词对应部分的浊音



QAT 与 **重排** 和 **全局逻辑运算** 无法同时使用

2025/10/11